import{_ as J,B as ie,u as ee,c as B,f as $,w as de,g as i,a as n,h as I,i as s,j as a,k as j,m as _,d as e,t as h,b as v,F as te,e as oe,p as ce,l as g,q as R,v as T,C as Z,A as K,D as re,s as le,x as se,o as ue,E as pe}from"./index-EMiPBKNP.js";const q=x=>(le("data-v-6f0118dd"),x=x(),se(),x),_e=q(()=>e("h3",null,"새로운 책",-1)),ve={class:"DataBox",style:{display:"flex",gap:"32px","flex-direction":"row"}},me={style:{display:"flex","align-items":"center"}},he={class:"bookData"},xe={style:{display:"flex","flex-direction":"column",gap:"4px"}},fe={class:"bookSubData"},ge={style:{display:"flex","flex-wrap":"wrap",gap:"4px"}},ye={style:{display:"flex","flex-direction":"row",gap:"16px"}},ke={style:{"padding-right":"12px","box-shadow":"5px 0 0 -3px #999"}},we={class:"bookDetailTxt"},be={class:"category-buttons mt-4"},Be={style:{display:"flex","flex-direction":"column",gap:"6px",width:"100%"}},De={key:0,class:"rating",style:{display:"flex","flex-direction":"column",width:"100%",gap:"6px","margin-top":"32px"}},Se=q(()=>e("h4",{style:{color:"#999"}},"책의 평점을 남겨주세요.",-1)),Ce={class:"bookCustomBox",style:{display:"flex","flex-direction":"column",gap:"12px",width:"100%"}},Ve={class:"bookDayBox"},$e={key:0,style:{flex:"1 1 0",display:"flex","flex-direction":"column",gap:"8px"}},Ie=q(()=>e("h4",null,"독서 시작일",-1)),Me={key:1,style:{flex:"1 1 0",display:"flex","flex-direction":"column",gap:"8px"}},Ue=q(()=>e("h4",null,"독서 종료일",-1)),Ne={key:2,class:"selectDay",style:{width:"100px"}},Ee={key:3,class:"selectDay",style:{width:"100px"}},Re={class:"commentBox",style:{padding:"0"}},Te={class:"bottomBtBox"},je=q(()=>e("h5",null,"저장",-1)),qe={__name:"BookDetailModal",setup(x){const m=ie();console.log("Router object:",m);const l=ee(),d=B(()=>l.selectedBook),M=B({get:()=>l.showModal,set:p=>{p||l.closeModal()}}),D=B(()=>l.categories),y=p=>B({get:()=>l[p],set:o=>{l[p]=o}}),S=y("pages"),C=y("comment"),u=y("selectedCategory"),k=$(""),c=$(""),f=$(0),w=$("");de(()=>l.selectedBook,p=>{p?(k.value=l.startDate,c.value=l.endDate,w.value=l.readingPage||"",f.value=l.rating||0):(k.value="",c.value="",w.value="",f.value=0)});const P=l.closeModal,U=async()=>{const{data:p}=await K.auth.getSession(),o=p.session;if(console.log("Session:",o),!o){console.log("Redirecting to /before-login"),await re(),m.push("/before-login");return}const V={user_id:o.user.id,title:d.value.title,publisher:d.value.publisher,datetime:d.value.datetime,thumbnail:d.value.thumbnail,authors:JSON.stringify(d.value.authors),isbn:d.value.isbn,pages:S.value,reading_page:w.value,comment:C.value,start_date:k.value===""?null:k.value,end_date:c.value===""?null:c.value,rating:f.value,category:u.value};try{const{data:b,error:t}=await K.from("books").select("isbn").eq("user_id",o.user.id);if(t)throw console.error("Error fetching books:",t),t;if(b.some(Q=>Q.isbn===d.value.isbn)){alert("이미 저장된 책입니다.");return}const{data:A,error:E}=await K.from("books").insert([V]);if(E)throw console.error("Supabase error:",E),E;alert("책이 저장되었습니다."),loadBooks(),P()}catch(b){console.error("Error saving book:",b),alert("책 저장에 실패했습니다.")}},N=p=>p?p.split("-")[0]:"";return(p,o)=>{const V=i("v-icon"),b=i("v-spacer"),t=i("v-card-title"),z=i("v-img"),A=i("v-btn"),E=i("v-rating"),Q=i("v-card-text"),ae=i("v-card"),ne=i("v-dialog");return n(),I(ne,{modelValue:M.value,"onUpdate:modelValue":o[6]||(o[6]=F=>M.value=F),"max-width":"500","max-height":"850"},{default:s(()=>[a(ae,{style:{"border-radius":"30px","box-shadow":"0 4px 25px #767676",height:"100%"}},{default:s(()=>[a(t,null,{default:s(()=>[a(b,{class:"bookCategory"},{default:s(()=>[a(V,{style:{color:"#A29cfe"}},{default:s(()=>[j("mdi-check")]),_:1}),_e]),_:1}),a(V,{onClick:_(P),size:"x-small",style:{position:"absolute",right:"30px",top:"30px"}},{default:s(()=>[j("mdi-close")]),_:1},8,["onClick"])]),_:1}),a(Q,{class:"bookDetailWrapper"},{default:s(()=>{var F,O,W,G,H,X,Y;return[e("div",ve,[e("div",me,[a(z,{src:(F=d.value)==null?void 0:F.thumbnail,class:"bookDetailImage"},null,8,["src"])]),e("div",he,[e("div",xe,[e("h1",null,h((O=d.value)==null?void 0:O.title),1),e("h3",null,"작가 : "+h(((G=(W=d.value)==null?void 0:W.authors)==null?void 0:G.join(", "))||"작가 정보 없음"),1)]),e("div",fe,[e("div",ge,[e("div",ye,[e("h4",ke,"발행연도 : "+h(N((H=d.value)==null?void 0:H.datetime)||"정보 없음"),1),e("h4",null,"출판사 : "+h(((X=d.value)==null?void 0:X.publisher)||"정보 없음"),1)]),e("h4",null,"ISBN: "+h((Y=d.value)==null?void 0:Y.isbn),1)])])])]),e("div",we,[e("div",be,[(n(!0),v(te,null,oe(D.value,r=>(n(),I(A,{key:r,onClick:lt=>u.value=r,class:ce(["categoryBtn",{selectedCategory:_(u)===r}])},{default:s(()=>[e("h3",null,h(r),1)]),_:2},1032,["onClick","class"]))),128))]),e("div",Be,[_(u)==="다 읽은 책"?(n(),v("div",De,[Se,a(E,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=r=>f.value=r),"background-color":"purple",color:"deep-purple-lighten-3",density:"compact",length:"5","half-increments":"",clearable:"",style:{"padding-left":"-2px"}},null,8,["modelValue"])])):g("",!0),e("div",Ce,[e("div",Ve,[_(u)!=="읽고 싶은 책"?(n(),v("div",$e,[Ie,_(u)!=="읽고 싶은 책"?R((n(),v("input",{key:0,"onUpdate:modelValue":o[1]||(o[1]=r=>k.value=r),label:"독서 시작일",type:"date",dense:"",class:"mt-4 selectDay",id:"modalStartDate",style:{width:"100%",display:"block"}},null,512)),[[T,k.value]]):g("",!0)])):g("",!0),_(u)==="다 읽은 책"?(n(),v("div",Me,[Ue,_(u)==="다 읽은 책"?R((n(),v("input",{key:0,"onUpdate:modelValue":o[2]||(o[2]=r=>c.value=r),type:"date",dense:"",class:"mt-4 selectDay",id:"modalEndDate",style:{width:"100%",display:"block"}},null,512)),[[T,c.value]]):g("",!0)])):g("",!0),_(u)!=="읽고 싶은 책"?(n(),v("div",Ne,[R(e("input",{"onUpdate:modelValue":o[3]||(o[3]=r=>Z(S)?S.value=r:null),dense:"",class:"mt-4 pageInput",id:"modalPages",placeholder:"전체"},null,512),[[T,_(S)]]),j("쪽 ")])):g("",!0),_(u)==="읽는 중인 책"?(n(),v("div",Ee,[_(u)==="읽는 중인 책"?R((n(),v("input",{key:0,"onUpdate:modelValue":o[4]||(o[4]=r=>w.value=r),placeholder:"읽은",dense:"",class:"mt-4 pageInput",id:"modalReadingPage"},null,512)),[[T,w.value]]):g("",!0),j("쪽 ")])):g("",!0)])]),e("div",Re,[R(e("textarea",{"onUpdate:modelValue":o[5]||(o[5]=r=>Z(C)?C.value=r:null),label:"코멘트",dense:"",class:"mt-4",id:"modalComment",style:{width:"100%","margin-top":"16px !important",padding:"0 16px 16px"},placeholder:"감상평을 작성해 주세요"},null,512),[[T,_(C)]])])])])]}),_:1}),e("div",Te,[a(A,{color:"#A29cfe",onClick:U,class:"mt-4 saveBt"},{default:s(()=>[je]),_:1})])]),_:1})]),_:1},8,["modelValue"])}}},Pe=J(qe,[["__scopeId","data-v-6f0118dd"]]),L=x=>(le("data-v-8faca8fc"),x=x(),se(),x),ze={key:0},Ae={style:{display:"flex","flex-direction":"column",gap:"48px",padding:"4px 0 18px 0"}},Fe={class:"txtBox"},Ke={style:{display:"flex",gap:"8px","align-items":"center"}},Le=L(()=>e("h3",null,"검색하기",-1)),Qe=L(()=>e("div",{class:"title"},[e("div",{style:{display:"flex","flex-direction":"column"}},[e("div",{style:{display:"flex",gap:"6px"}},[e("h1",{style:{color:"#a29cfe","letter-spacing":"0","font-size":"48px"}},"Bookeep"),e("h1",null,"과 함께 ")]),e("h1",null,"당신을 기다리는 16만권의 새로운 세상")]),e("div",null,[e("div",{class:"subTitle"},[e("h2",null,"로그인 하고"),e("h2",null,"독서의 새로운 세상을 탐험해보세요.")])])],-1)),Je=L(()=>e("h3",{style:{padding:"0 8px"}},"검색을 통해 어떤 도서가 있는지 확인해보세요",-1)),Oe={style:{width:"100%",display:"flex","flex-direction":"column","justify-content":"space-between",padding:"8px 0"}},We={style:{overflow:"hidden","text-overflow":"ellipsis",display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical"}},Ge={style:{display:"flex","flex-direction":"column",gap:"4px"}},He={style:{display:"flex","flex-direction":"row",gap:"16px"}},Xe={style:{"padding-right":"12px","box-shadow":"5px 0 0 -3px #c4c4c4"}},Ye=L(()=>e("h3",{style:{"text-align":"center",padding:"40px 0"}},"검색 결과가 없습니다.",-1)),Ze={__name:"SearchBook",setup(x){const m=ee(),l=$(m.query);B(()=>m.query);const d=B(()=>m.books),M=B(()=>m.showModal),D=$(!1),y=()=>{console.log("searchBooks 호출"),m.setQuery(l.value),m.searchBooks()},S=c=>{m.selectBook(c)},C=c=>c?c.split("-")[0]:"",u=["푸바오","인문학","신춘문예","우주","트렌드"],k=()=>{const c=Math.floor(Math.random()*u.length);return u[c]};return ue(async()=>{const{data:c}=await K.auth.getSession();D.value=!!c.session,console.log("isLoggedIn:",D.value),D.value||(l.value=k(),console.log("localQuery 설정:",l.value),y())}),(c,f)=>{const w=i("v-icon"),P=i("v-text-field"),U=i("v-col"),N=i("v-row"),p=i("v-img"),o=i("v-card-text"),V=i("v-card"),b=i("v-container");return n(),I(b,null,{default:s(()=>[D.value?g("",!0):(n(),v("div",ze,[e("div",Ae,[e("div",Fe,[e("div",Ke,[a(w,null,{default:s(()=>[j("mdi-magnify")]),_:1}),Le]),Qe]),Je])])),a(N,{"no-gutters":""},{default:s(()=>[a(U,{cols:" 12"},{default:s(()=>[a(P,{modelValue:l.value,"onUpdate:modelValue":f[0]||(f[0]=t=>l.value=t),onKeyup:pe(y,["enter"]),"onClick:prependInner":y,"onClick:appendInner":y,"prepend-inner-icon":"mdi-magnify","append-inner-icon":"mdi-arrow-right",class:"searchField",filled:"",rounded:"",dense:"",placeholder:"책 이름을 입력하세요"},null,8,["modelValue"])]),_:1})]),_:1}),d.value.length>0?(n(),I(N,{key:1,style:{display:"grid","grid-template-columns":`repeat(auto-fill, minmax(460px,
          1fr))`}},{default:s(()=>[(n(!0),v(te,null,oe(d.value,(t,z)=>(n(),I(U,{key:z,style:{padding:"8px"}},{default:s(()=>[a(V,{class:"bookCard",onClick:A=>S(t),outlined:"",flat:""},{default:s(()=>[a(o,{class:"bookThumbnail"},{default:s(()=>[a(p,{src:t.thumbnail},null,8,["src"])]),_:2},1024),e("div",Oe,[e("div",null,[e("p",We,h(t.title),1),e("h3",null,h(t.authors.length?t.authors.join(", "):"작가 정보 없음"),1)]),e("div",Ge,[e("div",He,[e("h4",Xe,"발행연도 : "+h(C(t==null?void 0:t.datetime)||"정보 없음"),1),e("h4",null,"출판사 : "+h((t==null?void 0:t.publisher)||"정보 없음"),1)]),e("h4",null,"ISBN: "+h(t==null?void 0:t.isbn),1)])])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})):(n(),I(N,{key:2},{default:s(()=>[a(U,null,{default:s(()=>[Ye]),_:1})]),_:1})),a(Pe,{modelValue:M.value,"onUpdate:modelValue":f[1]||(f[1]=t=>M.value=t)},null,8,["modelValue"])]),_:1})}}},et=J(Ze,[["__scopeId","data-v-8faca8fc"]]),tt={class:"main01",style:{width:"100%","max-width":"2000px"}},ot={__name:"SearchBooks",setup(x){return(m,l)=>(n(),v("div",tt,[a(et,{class:"SearchBook"})]))}},at=J(ot,[["__scopeId","data-v-3d334f46"]]);export{at as default};
